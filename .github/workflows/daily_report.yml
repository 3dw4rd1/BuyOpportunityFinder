# =============================================================================
# ETF TRACKER — GitHub Actions Workflow
# =============================================================================
# This file tells GitHub to automatically run your ETF tracker every morning.
#
# NZ Standard Time (NZST) = UTC+12  → 6am = 18:00 UTC
# NZ Daylight Time (NZDT) = UTC+13  → 6am = 17:00 UTC
#
# We use 17:00 UTC to ensure it always runs by 6am NZT across both seasons.
# On NZST days it'll arrive ~5am, on NZDT days exactly 6am. Safe either way.

name: Daily ETF Report

on:
  schedule:
    - cron: "0 17 * * 1-5"   # Runs at 17:00 UTC, Monday-Friday only
    - cron: "0 1 * * 2-6"  
                               # (no point running on weekends - markets are closed)
  workflow_dispatch:           # This lets you trigger it manually too - handy for testing!

jobs:
  run-etf-tracker:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Check out your code from GitHub
      - name: Checkout repository
        uses: actions/checkout@v4

      # Step 2: Set up Python
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      # Step 3: Install dependencies (requests)
      - name: Install dependencies
        run: pip install -r requirements.txt

      # Step 4: Run the tracker!
      # Both secrets are stored in GitHub Secrets - see README for setup instructions.
      - name: Run ETF tracker
        env:
          NTFY_TOPIC: ${{ secrets.NTFY_TOPIC }}
          ALPHA_VANTAGE_KEY: ${{ secrets.ALPHA_VANTAGE_KEY }}
        run: python main.py
